# 背景

假设有一个场景会用到分布式缓存，我们刚好有3台服务器，
我们对需要缓存的数据通过hash然后取余，就可以确定这个数据需要存储到那个服务器上面。通过同样的流程查找数据的时候有可以很快的找到。

现在有一个问题就是，如果3台服务器不够使用，我们加一台服务器，再对数据取余的时候从3边成4,所有的数据查找都会乱套。

# 一致性哈希算法


如果每次我们取余的值是固定的，就可以避免这个情况的出现。一直性哈希就是对2^32次方取余，然后把这2^32个数组成一个虚拟的圆。

对3台服务进行哈希运算，然后分布在这个虚拟的圆上面。

现在来了一批数据，在对数据进行hash，然后在虚拟圆上面向前推进，找到的第一个服务器，就存在这个服务上面。

如果需要扩容服务器，也只会影响到一台服务器。其他2台服务器的数据并不会受到影响。
这就是一致性哈希算法。


# 哈希偏斜

有可能出现一个问题就是对3台服务器哈希运算过后取余的结果，是很集中的 。这个就是hash偏斜，这样会造成一个问题，大部分的资源会打在一台服务器上面。让资源的分布不均匀。

解决办法就是：给3台服务器，增加虚拟节点，让虚拟的节点尽可能的均匀分布到虚拟环上面，资源打到虚拟节点，再通过虚拟节点找到真实的节点。


# 代码实现

